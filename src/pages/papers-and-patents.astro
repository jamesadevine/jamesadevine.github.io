---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
type Publications = CollectionEntry<"publications">["data"];

let publications = await getCollection("publications");

let mappedPublications = publications.map(
    (entry: CollectionEntry<"publications">) => entry.data,
);

// group publications by year, most recent first
mappedPublications = mappedPublications.sort((a, b) => {
    return (a.year || 0) - (b.year || 0);
});

let papers = mappedPublications.filter((pub) => pub.pub_type === "paper");
let patents = mappedPublications.filter((pub) => pub.pub_type === "patent");

const papersByYear = papers.reduce(
    (acc, pub) => {
        const year = pub.year || "Unknown";
        if (!acc[year]) {
            acc[year] = [];
        }
        acc[year].push(pub);
        return acc;
    },
    {} as Record<string, Publications[]>,
);

const patentsByYear = patents.reduce(
    (acc, pub) => {
        const year = pub.year || "Unknown";
        if (!acc[year]) {
            acc[year] = [];
        }
        acc[year].push(pub);
        return acc;
    },
    {} as Record<string, Publications[]>,
);

import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import Publication from "../layouts/Publication.astro";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    </head>
    <body>
        <Header />
        <main>
            <h1>Papers and Patents</h1>

            <section>
                <h2>Papers</h2>
                <Publication publications={papersByYear} />
            </section>

            <section>
                <h2>Patents</h2>
                <Publication publications={patentsByYear} />
            </section>
        </main>
        <Footer />
    </body>
</html>

<style>
    main {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2rem;
        margin-top: 2rem;
    }
    @media (max-width: 720px) {
        main {
            width: 100%;
        }
    }
</style>
